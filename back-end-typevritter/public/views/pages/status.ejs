<!doctype html>
<html>
  <%- include('../layout/header'); -%>
  <a-scene id="page">
    <a-entity id="wall_content">
      <% var i = 0; if (statuses) { %>
        <% statuses.forEach (function (status){ i+=1 %> 
          <a-entity id="<%status.id%>-status">
            <a-text id="<%status.id%>-headerstatus" position="-1 <%=i*0.2 %> -2" color="#4CC3D9" value="<%=status.user.name%>"></a-text>
            <a-text id="<%status.id%>-statuscontent" position="0 <%=i*0.2 %> -2" color="#4CC3D9" value="<%=status.content%>"></a-text>
        </a-entity>
      <% }) } %>
    </a-entity>
    <a-sky color="black"></a-sky>
  </a-scene>
  <%- include('../layout/footer'); -%>
  <!-- https://jesstelford.github.io/aframe-click-drag-component/basic/ -->
</html>
<script>
  const user_id = "<%=user_id%>"
  function refreshStatus() {
    axios.get('/get_status')
    .then(object => {
      var text = ''
      var i = 1
      $('#wall_content').empty()
      object.data.forEach (function (status){
        $('#wall_content').append(
          `<a-entity id=${status.id}-status>` +
            `<a-text id="${status.id}-headerstatus" position="-1 ${i*0.2} -2" color="#4CC3D9" value="${status.user.name}"></a-text>` + 
            `<a-text id="${status.id}-statuscontent" position="0 ${i*0.2} -2" color="#4CC3D9" value="${status.content}"></a-text>` + 
          `</a-entity>`
          )
        i+=1
      })
    })
  }
  $('#buttons').on('click', function(e){
    e.preventDefault()
    const content = $('#textarea-any').val()
    axios.post('status', {
      content: content
    })
    $('#textarea-any').val('')
    refreshStatus()
  });
</script>